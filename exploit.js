var master_b = new Uint32Array(2);
var slave_b =  new Uint32Array(2);
var slave_addr;
var slave_buf_addr;
var master_addr;

// نسخه 9.00
const ps4_9_00 = 2;
let target = ps4_9_00;

// اصلاح تابع لاگ برای هماهنگی با سایت شما
function debug_log(msg) {
    var statusDisplay = document.getElementById("selected");
    if (statusDisplay) {
        statusDisplay.textContent = msg;
    }
}

// توابع ریاضی ضروری که اکسپلویت به آن‌ها نیاز دارد
function check_range(x) { return (-0x80000000 <= x) && (x <= 0xffffffff); }

function Int64(low, high) {
    var buffer = new Uint32Array(2);
    buffer[0] = low;
    buffer[1] = high;
    this.buffer = buffer;
    this.low = function() { return this.buffer[0]; };
    this.high = function() { return this.buffer[1]; };
}

// تابع اصلی اجرا که در فایل index.html صدا زده می‌شود
function poc() {
    debug_log("Starting Exploit...");
    
    // فراخوانی موتور اصلی اکسپلویت از فایل kexploit.js
    if (typeof run_hax === "function") {
        try {
            run_hax();
        } catch (e) {
            debug_log("Execution Error: " + e.message);
        }
    } else {
        // اگر هنوز kexploit لود نشده باشد، مستقیماً تلاش برای اجرا
        if (typeof p !== 'undefined') {
             debug_log("System Ready. Running...");
             // اگر متغیر p در فایل‌های دیگر تعریف شده باشد، اینجا استفاده می‌شود
        } else {
             debug_log("Waiting for Kernel Scripts...");
             // تلاش مجدد بعد از یک وقفه کوتاه
             setTimeout(poc, 1000);
        }
    }
}

// حذف بخش انتهایی فایل قبلی که باعث ایجاد ارور Style و اینگوت اضافی می‌شد
console.log("PS4Master: Exploit logic patched and ready.");
