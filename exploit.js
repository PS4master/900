// اصلاح شده توسط Gemini - حذف اتوران
var master_b = new Uint32Array(2);
var slave_b =  new Uint32Array(2);
var slave_addr;
var slave_buf_addr;
var master_addr;

addEventListener('unhandledrejection', (event) => {
    const reason = event.reason;
    alert(
        `${reason}\n`
        + `${reason.sourceURL}:${reason.line}:${reason.column}\n`
        + `${reason.stack}`
    );
    throw reason;
})

const ps4_8_03 = 1;
const ps4_9_00 = 2;
const ps5_5_00 = ps4_9_00;
const ps4_6_50 = 3;
const ps4_6_00 = 4;
let target = ps4_9_00;

function set_target(value) {
    switch (value) {
        case ps4_8_03:
        case ps4_9_00:
        case ps4_6_00:
        case ps4_6_50:
            target = value;
            break;
        default:
            throw new Error(`Unsupported target version: ${value}`);
    }
}

// ... بقیه کدهای منطقی و محاسباتی اکسپلویت بدون تغییر در اینجا بمانند ...
// (کلاس‌های Int64، Memory و غیره)

// این تابع جدید جایگزین فراخوانی‌های خودکار انتهای فایل شده است
async function poc() {
    try {
        console.log("Starting Exploit via Manual Trigger...");
        
        // تنظیم ورژن هدف (در صورت نیاز می‌توانید از ورودی‌های HTML بگیرید)
        set_target(ps4_9_00); 
        
        // اجرای منطق اصلی جیلبریک
        // توجه: نام تابع اصلی شما در فایل قدیمی هر چه بوده (مثلاً run_exploit) 
        // باید محتوای آن را اینجا قرار دهید یا آن را اینجا صدا بزنید.
        
        // مثال:
        // await run_exploit_logic(); 
        
        // پیامی برای تست در کنسول
        alert("فرآیند اکسپلویت آغاز شد. لطفاً یو‌اس‌بی را متصل کنید.");
        
    } catch (err) {
        alert("خطا در اجرای اکسپلویت: " + err);
    }
}

// نکته مهم: تمام کدهای انتهای فایل که به صورت (function(){...})() بودند حذف شدند
// تا از اجرای خودکار جلوگیری شود.
